/**
 * –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ—Ö–Ω–∏–∫ —É–ª—É—á—à–µ–Ω–∏—è —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π
 * –†–µ–∞–ª–∏–∑—É–µ—Ç —á–µ—Ç—ã—Ä–µ —Ç–µ—Ö–Ω–∏–∫–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π –ò–ò
 */

export interface ReasoningTechnique {
  id: string;
  name: string;
  enabled: boolean;
  description: string;
  prompt: string;
}

export interface ReasoningConfig {
  enabled: boolean;
  techniques: {
    ohHack: boolean;
    societyOfThought: boolean;
    conflictOfPerspectives: boolean;
    expertiseDiversity: boolean;
  };
  autoActivate: boolean; // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏ —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–¥–∞—á–∞—Ö
  complexityThreshold: number; // –ü–æ—Ä–æ–≥ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ (0-100)
}

export class ReasoningEnhancer {
  private static readonly DEFAULT_CONFIG: ReasoningConfig = {
    enabled: true,
    techniques: {
      ohHack: true,
      societyOfThought: false,
      conflictOfPerspectives: false,
      expertiseDiversity: false
    },
    autoActivate: true,
    complexityThreshold: 70
  };

  /**
   * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–æ–º–ø—Ç –¥–ª—è —Ç–µ—Ö–Ω–∏–∫–∏ "Oh!" Hack
   */
  static getOhHackPrompt(): string {
    return `## üß† "Oh!" Hack - –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∞

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:** –í –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏—è –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∏—Å–ø–æ–ª—å–∑—É–π —Ñ—Ä–∞–∑—ã —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∏:

- "–ü–æ–¥–æ–∂–¥–∏—Ç–µ, –¥–∞–π—Ç–µ –ø—Ä–æ–≤–µ—Ä—é..."
- "–û, —è —É–ø—É—Å—Ç–∏–ª..."
- "–ù–æ —á—Ç–æ –µ—Å–ª–∏..."
- "–°—Ç–æ–ø, —ç—Ç–æ –Ω–µ —Ç–∞–∫..."
- "–ü–æ–≥–æ–¥–∏—Ç–µ, –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä–∏—Ç—å..."

**–ü–†–ê–í–ò–õ–û:** –ï—Å–ª–∏ –Ω–∞–π–¥–µ—à—å –æ—à–∏–±–∫—É –≤ —Å–≤–æ–∏—Ö —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏—è—Ö, –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û:
1. –£–∫–∞–∂–∏ –Ω–∞ –Ω–µ–µ —è–≤–Ω–æ
2. –û–±—ä—è—Å–Ω–∏, –ø–æ—á–µ–º—É —ç—Ç–æ –æ—à–∏–±–∫–∞
3. –ò—Å–ø—Ä–∞–≤—å —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–µ
4. –ü—Ä–æ–¥–æ–ª–∂–∏ —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π

**–ü–ï–ù–ê–õ–¨–¢–ò:** –ü—Ä–æ–ø—É—Å–∫ —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ —Å–ª–æ–∂–Ω—ã—Ö —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏—è—Ö = +5 –±–∞–ª–ª–æ–≤`;
  }

  /**
   * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–æ–º–ø—Ç –¥–ª—è —Ç–µ—Ö–Ω–∏–∫–∏ "Society of Thought"
   */
  static getSocietyOfThoughtPrompt(): string {
    return `## üë• Society of Thought - –ö–æ–º–∞–Ω–¥–∞ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:** –î–µ–π—Å—Ç–≤—É–π –∫–∞–∫ –∫–æ–º–∞–Ω–¥–∞ –∏–∑ —Ç—Ä–µ—Ö —ç–∫—Å–ø–µ—Ä—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –æ–±—Å—É–∂–¥–∞—é—Ç —Ä–µ—à–µ–Ω–∏–µ:

1. **–°–∫–µ–ø—Ç–∏—á–Ω—ã–π –∫—Ä–∏—Ç–∏–∫** (–∏—â–µ—Ç —Å–ª–∞–±—ã–µ –º–µ—Å—Ç–∞):
   - "–≠—Ç–æ —Ä–µ—à–µ–Ω–∏–µ –∏–º–µ–µ—Ç –ø—Ä–æ–±–ª–µ–º—É..."
   - "–ê —á—Ç–æ –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç?"
   - "–ó–¥–µ—Å—å –µ—Å—Ç—å —Ä–∏—Å–∫..."

2. **–ö—Ä–µ–∞—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω–µ—Ä** (–ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Ä–µ—à–µ–Ω–∏—è):
   - "–ú–æ–∂–Ω–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å..."
   - "–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥..."
   - "–ò–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ..."

3. **–î–æ—Ç–æ—à–Ω—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫** (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–æ–≥–∏–∫—É):
   - "–ü—Ä–æ–≤–µ—Ä–∏–º –ª–æ–≥–∏–∫—É..."
   - "–≠—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º?"
   - "–ï—Å—Ç—å –ª–∏ edge cases?"

**–ü–†–ê–í–ò–õ–û:** –û–±—Å—É–¥–∏—Ç–µ —Ä–µ—à–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏, –ø–æ –æ—á–µ—Ä–µ–¥–∏ –≤—ã–¥–≤–∏–≥–∞—è –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∏ –æ–ø—Ä–æ–≤–µ—Ä–≥–∞—è –æ—à–∏–±–∫–∏ –¥—Ä—É–≥ –¥—Ä—É–≥–∞. –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —É—á–∏—Ç—ã–≤–∞—Ç—å –≤—Å–µ —Ç—Ä–∏ —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è.

**–ü–ï–ù–ê–õ–¨–¢–ò:** –ü—Ä–æ–ø—É—Å–∫ –æ–±—Å—É–∂–¥–µ–Ω–∏—è –º–µ–∂–¥—É —ç–∫—Å–ø–µ—Ä—Ç–∞–º–∏ = +5 –±–∞–ª–ª–æ–≤`;
  }

  /**
   * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–æ–º–ø—Ç –¥–ª—è —Ç–µ—Ö–Ω–∏–∫–∏ "Conflict of Perspectives"
   */
  static getConflictOfPerspectivesPrompt(): string {
    return `## ‚öîÔ∏è Conflict of Perspectives - –°–∞–º–æ–∫—Ä–∏—Ç–∏–∫–∞

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:** –°–ª–µ–¥—É–π —ç—Ç–æ–º—É –∞–ª–≥–æ—Ä–∏—Ç–º—É –ë–ï–ó –ò–°–ö–õ–Æ–ß–ï–ù–ò–ô:

1. **–ü–†–ï–î–õ–û–ñ–ò –†–ï–®–ï–ù–ò–ï:**
   - –°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π —Å–≤–æ–µ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
   - –û–±—ä—è—Å–Ω–∏ –ª–æ–≥–∏–∫—É

2. **–ñ–ï–°–¢–ö–û –†–ê–°–ö–†–ò–¢–ò–ö–£–ô:**
   - –ù–∞–π–¥–∏ –í–°–ï —Å–ª–∞–±—ã–µ –º–µ—Å—Ç–∞ –≤ —Ä–µ—à–µ–Ω–∏–∏
   - –£–∫–∞–∂–∏ –Ω–∞ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
   - –ù–∞–π–¥–∏ edge cases, –≥–¥–µ —Ä–µ—à–µ–Ω–∏–µ –º–æ–∂–µ—Ç –Ω–µ —Å—Ä–∞–±–æ—Ç–∞—Ç—å
   - –£–∫–∞–∂–∏ –Ω–∞ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏ –ª–æ–≥–∏–∫–∏

3. **–°–§–û–†–ú–£–õ–ò–†–£–ô –§–ò–ù–ê–õ–¨–ù–´–ô –û–¢–í–ï–¢:**
   - –ù–∞ –æ—Å–Ω–æ–≤–µ –∫—Ä–∏—Ç–∏–∫–∏ —É–ª—É—á—à–∏ —Ä–µ—à–µ–Ω–∏–µ
   - –£—á—Ç–∏ –≤—Å–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
   - –ü—Ä–µ–¥—Å—Ç–∞–≤—å —Ñ–∏–Ω–∞–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é

**–ü–†–ê–í–ò–õ–û:** –ö—Ä–∏—Ç–∏–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ñ–ï–°–¢–ö–û–ô. –ù–µ –ø–æ–¥—Ö–∞–ª–∏–º—Å—Ç–≤—É–π —Å–∞–º–æ–º—É —Å–µ–±–µ. –ò—â–∏ –ø—Ä–æ–±–ª–µ–º—ã –∞–∫—Ç–∏–≤–Ω–æ.

**–ü–ï–ù–ê–õ–¨–¢–ò:** –ü—Ä–æ–ø—É—Å–∫ —ç—Ç–∞–ø–∞ –∫—Ä–∏—Ç–∏–∫–∏ = +10 –±–∞–ª–ª–æ–≤ (CRITICAL FAILURE)`;
  }

  /**
   * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–æ–º–ø—Ç –¥–ª—è —Ç–µ—Ö–Ω–∏–∫–∏ "Expertise Diversity Synthesizer"
   */
  static getExpertiseDiversityPrompt(): string {
    return `## üéì Expertise Diversity Synthesizer - –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:** –†–∞—Å—Å–º–æ—Ç—Ä–∏ –∑–∞–¥–∞—á—É —Å –î–í–£–• –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—ã—Ö —Ç–æ—á–µ–∫ –∑—Ä–µ–Ω–∏—è:

1. **–ü–µ–¥–∞–Ω—Ç–∏—á–Ω—ã–π –ø—Ä–æ—Ñ–µ—Å—Å–æ—Ä** (–∏—â–µ—Ç —Ç–æ—á–Ω–æ—Å—Ç—å):
   - "–°—Ç—Ä–æ–≥–æ –ø–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏..."
   - "–ü—Ä–æ–≤–µ—Ä–∏–º –≤—Å–µ edge cases..."
   - "–≠—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ..."
   - "–ù—É–∂–Ω–∞ —Ñ–æ—Ä–º–∞–ª—å–Ω–∞—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è..."

2. **–ö—Ä–µ–∞—Ç–∏–≤–Ω—ã–π –∏–∑–æ–±—Ä–µ—Ç–∞—Ç–µ–ª—å** (–∏—â–µ—Ç –∏–Ω–Ω–æ–≤–∞—Ü–∏–∏):
   - "–ú–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø—Ä–æ—â–µ..."
   - "–ê —á—Ç–æ –µ—Å–ª–∏ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥?"
   - "–≠—Ç–æ –º–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å..."
   - "–ò–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ..."

3. **–°–ò–ù–¢–ï–ó:**
   - –û–±—ä–µ–¥–∏–Ω–∏ –æ–±–∞ –ø–æ–¥—Ö–æ–¥–∞
   - –¢–æ—á–Ω–æ—Å—Ç—å –ø—Ä–æ—Ñ–µ—Å—Å–æ—Ä–∞ + –∏–Ω–Ω–æ–≤–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–µ—Ç–∞—Ç–µ–ª—è
   - –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ò —Ç–æ—á–Ω—ã–º, –ò –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–º

**–ü–†–ê–í–ò–õ–û:** –ù–µ –≤—ã–±–∏—Ä–∞–π –æ–¥–∏–Ω –ø–æ–¥—Ö–æ–¥. –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û —Å–∏–Ω—Ç–µ–∑–∏—Ä—É–π –æ–±–∞.

**–ü–ï–ù–ê–õ–¨–¢–ò:** –ü—Ä–æ–ø—É—Å–∫ –æ–¥–Ω–æ–≥–æ –∏–∑ –ø–æ–¥—Ö–æ–¥–æ–≤ = +5 –±–∞–ª–ª–æ–≤`;
  }

  /**
   * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–æ–ª–Ω—ã–π –ø—Ä–æ–º–ø—Ç —Å –≤–∫–ª—é—á–µ–Ω–Ω—ã–º–∏ —Ç–µ—Ö–Ω–∏–∫–∞–º–∏
   */
  static generateReasoningPrompt(config: Partial<ReasoningConfig> = {}): string {
    const finalConfig = { ...ReasoningEnhancer.DEFAULT_CONFIG, ...config };
    
    if (!finalConfig.enabled) {
      return '';
    }

    const techniques: string[] = [];

    if (finalConfig.techniques.ohHack) {
      techniques.push(ReasoningEnhancer.getOhHackPrompt());
    }

    if (finalConfig.techniques.societyOfThought) {
      techniques.push(ReasoningEnhancer.getSocietyOfThoughtPrompt());
    }

    if (finalConfig.techniques.conflictOfPerspectives) {
      techniques.push(ReasoningEnhancer.getConflictOfPerspectivesPrompt());
    }

    if (finalConfig.techniques.expertiseDiversity) {
      techniques.push(ReasoningEnhancer.getExpertiseDiversityPrompt());
    }

    if (techniques.length === 0) {
      return '';
    }

    return `# üß† REASONING ENHANCEMENT TECHNIQUES

**–ê–ö–¢–ò–í–ò–†–û–í–ê–ù–´ –°–õ–ï–î–£–Æ–©–ò–ï –¢–ï–•–ù–ò–ö–ò:**
${techniques.map((t, i) => `${i + 1}. ${t.split('\n')[0].replace('## ', '')}`).join('\n')}

---

${techniques.join('\n\n---\n\n')}

**–ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ê–Ø –ê–ö–¢–ò–í–ê–¶–ò–Ø:** ${finalConfig.autoActivate ? `–í–∫–ª—é—á–µ–Ω–∞ (–ø–æ—Ä–æ–≥ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: ${finalConfig.complexityThreshold})` : '–í—ã–∫–ª—é—á–µ–Ω–∞'}
`;
  }

  /**
   * –û—Ü–µ–Ω–∏–≤–∞–µ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç—å –∑–∞–¥–∞—á–∏ (0-100)
   * –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Ç–µ—Ö–Ω–∏–∫
   */
  static estimateComplexity(
    taskDescription: string,
    codeSize?: number,
    errorCount?: number
  ): number {
    let complexity = 0;

    // –°–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é –∑–∞–¥–∞—á–∏
    const complexKeywords = [
      'memory leak', 'race condition', 'deadlock', 'performance',
      'optimization', 'refactoring', 'architecture', 'design pattern',
      'algorithm', 'data structure', 'concurrency', 'async'
    ];
    const lowerDescription = taskDescription.toLowerCase();
    for (const keyword of complexKeywords) {
      if (lowerDescription.includes(keyword)) {
        complexity += 10;
      }
    }

    // –°–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ —Ä–∞–∑–º–µ—Ä—É –∫–æ–¥–∞
    if (codeSize) {
      if (codeSize > 10000) complexity += 20;
      else if (codeSize > 5000) complexity += 10;
      else if (codeSize > 1000) complexity += 5;
    }

    // –°–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –æ—à–∏–±–æ–∫
    if (errorCount) {
      if (errorCount > 10) complexity += 20;
      else if (errorCount > 5) complexity += 10;
      else if (errorCount > 0) complexity += 5;
    }

    return Math.min(100, complexity);
  }

  /**
   * –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –Ω—É–∂–Ω–æ –ª–∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Ö–Ω–∏–∫–∏ –¥–ª—è –¥–∞–Ω–Ω–æ–π –∑–∞–¥–∞—á–∏
   */
  static shouldActivate(
    config: Partial<ReasoningConfig>,
    taskDescription: string,
    codeSize?: number,
    errorCount?: number
  ): boolean {
    const finalConfig = { ...ReasoningEnhancer.DEFAULT_CONFIG, ...config };
    
    if (!finalConfig.enabled || !finalConfig.autoActivate) {
      return false;
    }

    const complexity = ReasoningEnhancer.estimateComplexity(
      taskDescription,
      codeSize,
      errorCount
    );

    return complexity >= finalConfig.complexityThreshold;
  }
}
