# Тестирование MCP-интеграции RooTrace

## Обзор

Этот документ описывает процесс тестирования интеграции RooTrace с Model Context Protocol (MCP). Здесь приведены шаги для проверки корректной установки, регистрации и работы MCP-инструментов.

## Подготовка к тестированию

Перед началом тестирования убедитесь, что у вас установлены все необходимые зависимости:

```bash
npm install
```

## Шаги для проверки MCP-интеграции

### 1. Сборка расширения

Выполните команду для компиляции TypeScript-файлов:

```bash
npm run compile
```

Убедитесь, что все файлы в папке `out/` были созданы успешно:
- `out/extension.js`
- `out/mcp-server.js`
- `out/mcp-handler.js`
- `out/mcp-registration.js`

### 2. Упаковка расширения

Создайте VSIX-пакет расширения:

```bash
vsce package
```

Если у вас не установлен `vsce`, установите его глобально:

```bash
npm install -g vsce
```

### 3. Установка расширения

Установите расширение в VS Code:

```bash
code --install-extension debug-sidecar-*.vsix
```

Или через интерфейс VS Code:
- Откройте палитру команд (Ctrl+Shift+P)
- Выберите "Extensions: Install from VSIX..."
- Выберите созданный файл

### 4. Проверка авто-регистрации в mcpConfig.json

После запуска расширения проверьте, что сервер RooTrace зарегистрирован в `mcpConfig.json`:

1. Найдите файл `mcpConfig.json` (обычно находится в домашней директории пользователя)
2. Убедитесь, что в нем присутствует сервер с именем `roo-trace` или `RooTrace`
3. Проверьте, что у сервера есть все необходимые инструменты:
   - `roo_trace_start_session`
   - `roo_trace_stop_session`
   - `roo_trace_add_event`
   - `roo_trace_get_events`
   - `roo_trace_clear_events`
   - `roo_trace_export_trace`

### 5. Проверка видимости инструментов в Roo Code

1. Откройте Roo Code
2. Активируйте роль AI Debugger Pro
3. Проверьте, что MCP-инструменты RooTrace доступны в списке инструментов
4. Протестируйте работу каждого инструмента:
   - Запустите сессию трассировки
   - Добавьте несколько событий
   - Получите список событий
   - Экспортируйте трассировку
   - Очистите события
   - Остановите сессию

## Автоматические проверки

### Проверка MCP-интеграции

Запустите автоматическую проверку интеграции:

```bash
npm run test:mcp
```

Этот скрипт проверяет:
- Наличие и корректность структуры файла `mcpConfig.json`
- Наличие сервера RooTrace в конфигурации
- Наличие всех ожидаемых MCP-инструментов
- Корректность путей к файлам инструментов

### Проверка сборки

Запустите проверку сборки:

```bash
npm run verify
```

Этот скрипт проверяет:
- Наличие скомпилированных файлов в папке `out/`
- Корректность путей в `package.json`
- Наличие зависимостей

## Ожидаемые результаты

После успешного прохождения всех проверок:
1. Расширение установлено и активировано
2. Сервер RooTrace зарегистрирован в `mcpConfig.json`
3. Все MCP-инструменты доступны в Roo Code
4. Автоматические проверки завершаются без ошибок
5. Возможна полноценная работа с трассировкой через MCP-инструменты

## Troubleshooting

### Проблемы с регистрацией в mcpConfig.json

Если сервер RooTrace не регистрируется автоматически:

1. Проверьте, что расширение запущено
2. Перезапустите VS Code
3. Проверьте логи расширения на наличие ошибок
4. Убедитесь, что у расширения есть права на запись в `mcpConfig.json`

### Инструменты не отображаются в Roo Code

1. Проверьте, что роль AI Debugger Pro активирована
2. Убедитесь, что MCP-сервер запущен
3. Перезапустите Roo Code
4. Проверьте, что `mcpConfig.json` содержит корректные пути к инструментам

### Ошибки при выполнении инструментов

1. Проверьте формат передаваемых параметров
2. Убедитесь, что сессия трассировки запущена перед добавлением событий
3. Проверьте логи для получения дополнительной информации об ошибках

### Ошибки сборки

Если возникают ошибки при компиляции:

1. Проверьте версию TypeScript: `tsc --version`
2. Убедитесь, что все зависимости установлены: `npm install`
3. Проверьте конфигурацию в `tsconfig.json`

## Дополнительные ресурсы

- [Документация по MCP](https://modelcontextprotocol.com/)
- [Руководство по установке](./docs/INSTALLATION_GUIDE.md)
- [Руководство по интеграции MCP](./docs/MCP_INTEGRATION_GUIDE.md)