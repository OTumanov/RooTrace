# Руководство по установке расширения Debug Sidecar (MCP-архитектура)

## Введение

Debug Sidecar — это расширение для Visual Studio Code, предназначенное для упрощения процесса отладки приложений через интеграцию с Model Context Protocol (MCP). Расширение автоматически анализирует проект, регистрирует MCP-сервер RooTrace и настраивает необходимые параметры отладки без ручной конфигурации. Оно обеспечивает интеграцию с различными средами разработки и предоставляет удобный веб-интерфейс для мониторинга и управления процессами отладки через MCP-инструменты.

## Требования

Для корректной работы расширения Debug Sidecar с MCP-интеграцией необходимо наличие следующих компонентов:

- **Node.js** версии 16.x или выше
- **Visual Studio Code** версии 1.85 или выше (поддержка MCP)
- **npm** или **yarn** для управления зависимостями
- **Git** для клонирования репозитория (при установке из исходного кода)
- **Roo Code** расширение (для использования MCP-инструментов)
- Свободные порты для работы внутреннего MCP-сервера RooTrace

## Сборка проекта из исходного кода

### Установка зависимостей

1. Клонируйте репозиторий расширения:
   ```bash
   git clone https://github.com/your-repo/debug-sidecar.git
   cd debug-sidecar
   ```

2. Установите зависимости проекта:
   ```bash
   npm install
   ```
   
   Или при использовании yarn:
   ```bash
   yarn install
   ```

### Компиляция TypeScript

Для компиляции исходного кода TypeScript выполните команду:

```bash
npm run compile
```

или при использовании yarn:

```bash
yarn compile
```

Это преобразует все файлы TypeScript в исполняемые JavaScript-файлы.

### Создание VSIX пакета

Для создания установочного пакета расширения выполните:

```bash
npm run package
```

или при использовании yarn:

```bash
yarn package
```

В результате будет создан файл с расширением `.vsix`, который можно использовать для установки расширения в VSCode.

## Установка расширения в VSCode

### Установка из VSIX файла

1. Откройте Visual Studio Code
2. Перейдите в раздел "Extensions" (Расширения) через боковую панель
3. Нажмите на три точки (...) в правом верхнем углу меню расширений
4. Выберите "Install from VSIX..." (Установить из VSIX...)
5. Выберите созданный файл `debug-sidecar-0.0.1.vsix`
6. Подтвердите установку

### Проверка установки

После установки расширение должно появиться в списке установленных. Для проверки:

1. Перезапустите Visual Studio Code
2. Откройте список расширений
3. Найдите "Debug Sidecar" в списке установленных расширений
4. Убедитесь, что статус расширения активен (включен)

## Первый запуск и проверка

### Автозапуск MCP-сервера

При первом открытии проекта расширение автоматически запустит внутренний MCP-сервер RooTrace. Это может занять несколько секунд. В нижней части окна VSCode должен появиться индикатор состояния с информацией о запущенном сервере.

### Автоматическая регистрация MCP-сервера

Расширение автоматически зарегистрирует MCP-сервер RooTrace в системе MCP:

1. Сервер регистрируется в конфигурационном файле MCP
2. Все необходимые инструменты становятся доступны для Roo Code
3. Процесс полностью автоматизирован (Zero-Config)

### Создание конфигурационных файлов

Расширение автоматически создаст необходимые конфигурационные файлы в вашем проекте:

- `.ai_debug_config` — JSON-файл с URL сервера, статусом и timestamp (создается автоматически при запуске сервера)
- `.debug_port` — текстовый файл с номером порта сервера (создается автоматически при запуске сервера)

## Проверка MCP-интеграции

После установки и запуска расширения проверьте работоспособность MCP-интеграции:

1. Убедитесь, что MCP-сервер RooTrace зарегистрирован:
   - Откройте палитру команд (Ctrl+Shift+P)
   - Выполните команду "MCP: List Available Tools"
   - Найдите среди инструментов `read_runtime_logs`, `get_debug_status`, `clear_session`, `inject_probes`

2. Проверьте статус сервера:
   - В Roo Code выполните вызов инструмента `get_debug_status`
   - Должен вернуться статус сервера и список активных гипотез

3. Проверьте работу инструментов:
   - Вызовите `read_runtime_logs` для получения текущих логов
   - Вызовите `clear_session` для очистки сессии
   - Вызовите `inject_probes` для тестирования инъекции проб

### Автозапуск сервера

При первом открытии проекта расширение автоматически запустит внутренний сервер отладки. Это может занять несколько секунд. В нижней части окна VSCode должен появиться индикатор состояния с информацией о запущенном сервере.

### Создание конфигурационных файлов

Расширение автоматически создаст необходимые конфигурационные файлы в вашем проекте:

- `.ai_debug_config` — JSON-файл с URL сервера, статусом и timestamp (создается автоматически при запуске сервера)
- `.debug_port` — текстовый файл с номером порта сервера (создается автоматически при запуске сервера)

### Открытие Dashboard

Для доступа к веб-интерфейсу отладки:

1. Нажмите на значок Debug Sidecar в строке состояния VSCode
2. Или откройте командную палитру (Ctrl+Shift+P) и выполните команду "Debug Sidecar: Open Dashboard"
3. В браузере откроется веб-интерфейс с информацией о текущих процессах отладки

## Устранение неполадок

### Проблема: Сервер не запускается при открытии проекта

**Решение:**
1. Проверьте, что Node.js установлен и доступен в PATH
2. Убедитесь, что порты 3000 и 3001 не заняты другими приложениями
3. Перезапустите VSCode с правами администратора
4. Проверьте логи в Output > Debug Sidecar

### Проблема: Dashboard не открывается

**Решение:**
1. Проверьте, что сервер успешно запущен (индикатор в строке состояния)
2. Убедитесь, что браузер не блокирует открытие локального URL
3. Попробуйте открыть Dashboard в другом браузере
4. Проверьте настройки фаервола

### Проблема: Ошибки при сборке проекта

**Решение:**
1. Убедитесь, что версия Node.js соответствует требованиям
2. Удалите папку `node_modules` и перезапустите `npm install`
3. Проверьте права доступа к рабочей директории
4. Обновите npm до последней версии: `npm install -g npm@latest`

### Проблема: Не обнаружены конфигурации отладки

**Решение:**
1. Убедитесь, что вы открыли корневую директорию проекта в VSCode
2. Проверьте наличие файлов package.json, requirements.txt или других файлов конфигурации фреймворка
3. Перезапустите расширение командой "Debug Sidecar: Restart Extension"
4. Проверьте поддерживаемые типы проектов в документации

### Дополнительная диагностика

Для получения более подробной информации об ошибках:

1. Откройте Output панель в VSCode
2. Выберите "Debug Sidecar" из выпадающего списка
3. Изучите логи для получения дополнительной информации об ошибках
4. При необходимости создайте issue в репозитории проекта с содержимым логов