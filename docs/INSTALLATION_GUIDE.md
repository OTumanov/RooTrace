# Руководство по установке расширения Debug Sidecar (MCP-архитектура)

## Введение

Debug Sidecar — это расширение для Visual Studio Code, предназначенное для упрощения процесса отладки приложений через интеграцию с Model Context Protocol (MCP). Расширение автоматически:

- Запускает локальный HTTP-сервер для приёма отладочных данных
- Регистрирует MCP-сервер RooTrace для интеграции с AI-ассистентами
- Автоматически детектирует установленное расширение (Roo Code или Roo Cline)
- Создаёт необходимые конфигурационные файлы без ручной настройки
- Предоставляет WebView Dashboard для визуализации логов в реальном времени

## Требования

Для корректной работы расширения Debug Sidecar с MCP-интеграцией необходимо наличие следующих компонентов:

- **Node.js** версии 16.x или выше
- **Visual Studio Code** версии 1.85 или выше
- **npm** или **yarn** для управления зависимостями
- **Git** для клонирования репозитория (при установке из исходного кода)
- **Roo Code** или **Roo Cline** расширение (для использования MCP-инструментов)
- Свободные порты для работы внутреннего HTTP-сервера

## Сборка проекта из исходного кода

### Установка зависимостей

1. Клонируйте репозиторий расширения:
   ```bash
   git clone https://github.com/your-repo/debug-sidecar.git
   cd debug-sidecar
   ```

2. Установите зависимости проекта:
   ```bash
   npm install
   ```
   
   Или при использовании yarn:
   ```bash
   yarn install
   ```

### Компиляция TypeScript

Для компиляции исходного кода TypeScript выполните команду:

```bash
npm run compile
```

или при использовании yarn:

```bash
yarn compile
```

Это преобразует все файлы TypeScript в исполняемые JavaScript-файлы.

### Создание VSIX пакета

Для создания установочного пакета расширения выполните:

```bash
npm run package
```

или при использовании yarn:

```bash
yarn package
```

В результате будет создан файл с расширением `.vsix`, который можно использовать для установки расширения в VSCode.

## Установка расширения в VSCode

### Установка из VSIX файла

1. Откройте Visual Studio Code
2. Перейдите в раздел "Extensions" (Расширения) через боковую панель
3. Нажмите на три точки (...) в правом верхнем углу меню расширений
4. Выберите "Install from VSIX..." (Установить из VSIX...)
5. Выберите созданный файл `debug-sidecar-0.0.1.vsix`
6. Подтвердите установку

### Проверка установки

После установки расширение должно появиться в списке установленных. Для проверки:

1. Перезапустите Visual Studio Code
2. Откройте список расширений
3. Найдите "Debug Sidecar" в списке установленных расширений
4. Убедитесь, что статус расширения активен (включен)

## Первый запуск и проверка

### Автозапуск HTTP-сервера

При первом открытии проекта расширение автоматически запустит внутренний HTTP-сервер на случайном свободном порту. Это происходит мгновенно. В канале вывода «AI Debugger» появится сообщение о запущенном сервере.

### Автоматическая регистрация MCP-сервера

Расширение автоматически зарегистрирует MCP-сервер RooTrace:

1. Автоматически детектирует установленное расширение (Roo Code или Roo Cline)
2. Создаёт конфигурацию в файле `.roo/mcp.json` в корне рабочей области
3. Все MCP-инструменты становятся доступны для AI-ассистента
4. Процесс полностью автоматизирован (Zero-Config)

### Создание конфигурационных файлов

Расширение автоматически создаст необходимые конфигурационные файлы в вашем проекте:

- `.roo/mcp.json` — конфигурация MCP-сервера RooTrace (создаётся автоматически при активации расширения)
- `.ai_debug_config` — JSON-файл с URL HTTP-сервера, статусом и timestamp (создаётся автоматически при запуске сервера)
- `.debug_port` — текстовый файл с номером порта HTTP-сервера (создаётся автоматически при запуске сервера)
- `.ai_debug_logs.json` — файл для персистентного хранения логов отладки (создаётся при первом логе)

## Проверка MCP-интеграции

После установки и запуска расширения проверьте работоспособность MCP-интеграции:

1. Убедитесь, что MCP-сервер RooTrace зарегистрирован:
   - Откройте палитру команд (Ctrl+Shift+P)
   - Выполните команду "MCP: List Available Tools"
   - Найдите среди инструментов `read_runtime_logs`, `get_debug_status`, `clear_session`, `inject_probes`

2. Проверьте статус сервера:
   - В Roo Code выполните вызов инструмента `get_debug_status`
   - Должен вернуться статус сервера и список активных гипотез

3. Проверьте работу инструментов:
   - Вызовите `read_runtime_logs` для получения текущих логов
   - Вызовите `clear_session` для очистки сессии
   - Вызовите `inject_probes` для тестирования инъекции проб

### Открытие Dashboard

Для доступа к WebView Dashboard отладки:

1. Откройте командную палитру (Ctrl+Shift+P / Cmd+Shift+P)
2. Выполните команду "AI Debugger: Open Dashboard" (`ai-debugger.openDashboard`)
3. Справа откроется панель с заголовком «AI Debugger Dashboard»
4. Логи будут отображаться в реальном времени по мере их поступления

## Устранение неполадок

### Проблема: Сервер не запускается при открытии проекта

**Решение:**
1. Проверьте, что Node.js установлен и доступен в PATH
2. HTTP-сервер использует случайный свободный порт, поэтому конфликты портов маловероятны
3. Перезапустите VSCode
4. Проверьте логи в Output > AI Debugger

### Проблема: MCP-инструменты недоступны

**Решение:**
1. Проверьте, что расширение Roo Code или Roo Cline установлено и активно
2. Проверьте наличие файла `.roo/mcp.json` в корне проекта
3. Перезапустите VSCode после изменения конфигурации
4. Проверьте формат конфигурации в `.roo/mcp.json`

### Проблема: Ошибки при сборке проекта

**Решение:**
1. Убедитесь, что версия Node.js соответствует требованиям
2. Удалите папку `node_modules` и перезапустите `npm install`
3. Проверьте права доступа к рабочей директории
4. Обновите npm до последней версии: `npm install -g npm@latest`

### Проблема: Логи не появляются в Dashboard

**Решение:**
1. Убедитесь, что HTTP-сервер запущен (проверьте канал Output > AI Debugger)
2. Проверьте, что файл `.debug_port` существует в корне проекта
3. Убедитесь, что отладочный код отправляет POST-запросы на правильный порт
4. Проверьте наличие файла `.ai_debug_logs.json` для персистентного хранения

### Дополнительная диагностика

Для получения более подробной информации об ошибках:

1. Откройте Output панель в VSCode
2. Выберите "Debug Sidecar" из выпадающего списка
3. Изучите логи для получения дополнительной информации об ошибках
4. При необходимости создайте issue в репозитории проекта с содержимым логов