# üîç –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º MCP –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ RooTrace

## –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ Initialize Request
**–ü—Ä–æ–±–ª–µ–º–∞**: MCP –ø—Ä–æ—Ç–æ–∫–æ–ª —Ç—Ä–µ–±—É–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É `initialize` –∑–∞–ø—Ä–æ—Å–∞ –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã.

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**:
- –í `mcp-handler.ts` –Ω–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –¥–ª—è `InitializeRequestSchema`
- –°–µ—Ä–≤–µ—Ä —Å–æ–∑–¥–∞–µ—Ç—Å—è, –Ω–æ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç —Ñ–∞–∑—É –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–æ–≥–ª–∞—Å–Ω–æ MCP —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è**:
- MCP –∫–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –ù–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è capabilities –∫–ª–∏–µ–Ω—Ç–∞
- –ù–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤–µ—Ä—Å–∏—è –ø—Ä–æ—Ç–æ–∫–æ–ª–∞

**–†–µ—à–µ–Ω–∏–µ**:
```typescript
import { InitializeRequestSchema } from '@modelcontextprotocol/sdk/types.js';

this.server.setRequestHandler(InitializeRequestSchema, async (request) => {
  return {
    protocolVersion: '2024-11-05',
    capabilities: {
      tools: {},
      // –î–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∏–µ capabilities –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    },
    serverInfo: {
      name: 'RooTrace',
      version: '0.0.1'
    }
  };
});
```

---

### 2. ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ CallToolRequestSchema
**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ –æ—à–∏–±–∫–µ –≤ `inject_probes` –∏–ª–∏ –¥—Ä—É–≥–∏—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `throw Error`, —á—Ç–æ –º–æ–∂–µ—Ç –Ω–∞—Ä—É—à–∏—Ç—å MCP –ø—Ä–æ—Ç–æ–∫–æ–ª.

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**:
```typescript
case 'inject_probes': {
  // ...
  const result = await injectProbe(...);
  // –ù–µ—Ç try-catch –≤–æ–∫—Ä—É–≥ injectProbe
  // –ï—Å–ª–∏ injectProbe –ø–∞–¥–∞–µ—Ç, –æ—à–∏–±–∫–∞ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è
}
default:
  throw new Error(`Unknown tool: ${name}`); // ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è**:
- –ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –º–æ–≥—É—Ç —Å–ª–æ–º–∞—Ç—å MCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
- –ö–ª–∏–µ–Ω—Ç –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π error response
- –ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

**–†–µ—à–µ–Ω–∏–µ**:
```typescript
case 'inject_probes': {
  try {
    const result = await injectProbe(filePath, lineNumber, probeType, message);
    return {
      content: [{ type: 'text', text: JSON.stringify(result) }]
    };
  } catch (error) {
    return {
      content: [{
        type: 'text',
        text: JSON.stringify({
          success: false,
          error: error instanceof Error ? error.message : String(error),
          errorCode: 'INJECTION_FAILED'
        })
      }],
      isError: true
    };
  }
}
default:
  return {
    content: [{
      type: 'text',
      text: JSON.stringify({
        success: false,
        error: `Unknown tool: ${name}`,
        errorCode: 'UNKNOWN_TOOL'
      })
    }],
    isError: true
  };
```

---

### 3. ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–µ–∂–¥—É HTTP —Å–µ—Ä–≤–µ—Ä–æ–º –∏ MCP —Å–µ—Ä–≤–µ—Ä–æ–º
**–ü—Ä–æ–±–ª–µ–º–∞**: –õ–æ–≥–∏ –ø—Ä–∏—Ö–æ–¥—è—Ç –Ω–∞ HTTP —Å–µ—Ä–≤–µ—Ä (`extension.ts`), –Ω–æ MCP —Å–µ—Ä–≤–µ—Ä (`mcp-handler.ts`) –∏–º–µ–µ—Ç —Å–≤–æ–π –æ—Ç–¥–µ–ª—å–Ω—ã–π `DebugSession`, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç —ç—Ç–∏ –ª–æ–≥–∏.

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**:
- HTTP —Å–µ—Ä–≤–µ—Ä —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ª–æ–≥–∏ –≤ `SharedLogStorage` –∏ `.rootrace/ai_debug_logs.json`
- MCP —Å–µ—Ä–≤–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π `debugSession` —Å –ø—É—Å—Ç—ã–º–∏ –ª–æ–≥–∞–º–∏
- `read_runtime_logs` –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è**:
- `read_runtime_logs` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç—ã–µ –ª–æ–≥–∏
- –ù–µ—Ç —Å–≤—è–∑–∏ –º–µ–∂–¥—É HTTP endpoint –∏ MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –ª–æ–≥–∏ —á–µ—Ä–µ–∑ MCP

**–†–µ—à–µ–Ω–∏–µ**:
1. –°–æ–∑–¥–∞—Ç—å –æ–±—â–∏–π storage –¥–ª—è –ª–æ–≥–æ–≤ (singleton –∏–ª–∏ shared state)
2. HTTP —Å–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω –¥–æ–±–∞–≤–ª—è—Ç—å –ª–æ–≥–∏ –≤ –æ–±—â–∏–π storage
3. MCP —Å–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω —á–∏—Ç–∞—Ç—å –∏–∑ —Ç–æ–≥–æ –∂–µ storage

```typescript
// –°–æ–∑–¥–∞—Ç—å shared log storage
class SharedLogStorage {
  private static instance: SharedLogStorage;
  private logs: RuntimeLog[] = [];
  
  static getInstance(): SharedLogStorage {
    if (!SharedLogStorage.instance) {
      SharedLogStorage.instance = new SharedLogStorage();
    }
    return SharedLogStorage.instance;
  }
  
  addLog(log: RuntimeLog) { /* ... */ }
  getLogs(): RuntimeLog[] { /* ... */ }
}
```

---

### 4. ‚ùå EventEmitter —Å–æ–∑–¥–∞–Ω, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
**–ü—Ä–æ–±–ª–µ–º–∞**: –í `RooTraceMCPHandler` —Å–æ–∑–¥–∞–µ—Ç—Å—è `EventEmitter`, –Ω–æ –æ–Ω –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è.

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**:
```typescript
private emitter: EventEmitter;

constructor() {
  this.emitter = new EventEmitter(); // –°–æ–∑–¥–∞–Ω, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
}
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è**:
- –ú–µ—Ä—Ç–≤—ã–π –∫–æ–¥
- –£–ø—É—â–µ–Ω–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–ª—è event-driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- –ù–µ—Ç —Å–ø–æ—Å–æ–±–∞ —É–≤–µ–¥–æ–º–ª—è—Ç—å –æ —Å–æ–±—ã—Ç–∏—è—Ö (–Ω–æ–≤—ã–µ –ª–æ–≥–∏, –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞)

**–†–µ—à–µ–Ω–∏–µ**:
- –õ–∏–±–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å EventEmitter –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –õ–∏–±–æ —É–¥–∞–ª–∏—Ç—å, –µ—Å–ª–∏ –Ω–µ –Ω—É–∂–µ–Ω

---

### 5. ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ Notifications
**–ü—Ä–æ–±–ª–µ–º–∞**: MCP –ø—Ä–æ—Ç–æ–∫–æ–ª –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç notifications (–æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è), –Ω–æ –æ–Ω–∏ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è.

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**:
- –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –¥–ª—è notifications
- –ù–µ—Ç —Å–ø–æ—Å–æ–±–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å notifications –∫–ª–∏–µ–Ω—Ç—É

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è**:
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —É–≤–µ–¥–æ–º–ª—è—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ –æ —Å–æ–±—ã—Ç–∏—è—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –ù–µ—Ç push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –Ω–æ–≤—ã—Ö –ª–æ–≥–∞—Ö

**–†–µ—à–µ–Ω–∏–µ**:
```typescript
// –ï—Å–ª–∏ MCP SDK –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç notifications
this.server.setNotificationHandler('logs/updated', (notification) => {
  // –û–±—Ä–∞–±–æ—Ç–∫–∞ notification –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞
});
```

---

### 6. ‚ùå –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å–æ–≥–ª–∞—Å–Ω–æ JSON Schema
**–ü—Ä–æ–±–ª–µ–º–∞**: –•–æ—Ç—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã JSON Schema –¥–ª—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤, –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é, –∞ –Ω–µ —á–µ—Ä–µ–∑ schema validation.

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**:
```typescript
// –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ä—É—á–Ω—É—é
if (!filePath || lineNumber === undefined || !probeType) {
  return { /* error */ };
}
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è**:
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- –í–æ–∑–º–æ–∂–Ω—ã –æ—à–∏–±–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ö–µ–º—ã
- –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤

**–†–µ—à–µ–Ω–∏–µ**:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É –¥–ª—è JSON Schema validation (–Ω–∞–ø—Ä–∏–º–µ—Ä, `ajv`)
- –ò–ª–∏ –ø–æ–ª–∞–≥–∞—Ç—å—Å—è –Ω–∞ MCP SDK –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏

---

### 7. ‚ùå –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ –æ—à–∏–±–∫–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ `mcp-server.ts` –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–æ—Å—Ç–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —Å `process.exit(1)`, –±–µ–∑ graceful shutdown.

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**:
```typescript
catch (error) {
  console.error('Failed to start RooTrace MCP Server:', error);
  process.exit(1); // ‚ùå –†–µ–∑–∫–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
}
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è**:
- –ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
- –ù–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
- –ü–ª–æ—Ö–æ–π UX

**–†–µ—à–µ–Ω–∏–µ**:
```typescript
catch (error) {
  console.error('Failed to start RooTrace MCP Server:', error);
  // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ñ–∞–π–ª –∏–ª–∏ output channel
  // –ü–æ–ø—ã—Ç–∫–∞ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Å backoff
  // –ò–ª–∏ graceful degradation
}
```

---

### 8. ‚ùå –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ shutdown/exit –∑–∞–ø—Ä–æ—Å–æ–≤
**–ü—Ä–æ–±–ª–µ–º–∞**: MCP –ø—Ä–æ—Ç–æ–∫–æ–ª –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ shutdown, –Ω–æ –æ–Ω–∏ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è.

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**:
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ SIGINT/SIGTERM
- –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ MCP shutdown request

**–†–µ—à–µ–Ω–∏–µ**:
```typescript
// –ï—Å–ª–∏ MCP SDK –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç shutdown request
this.server.setRequestHandler('shutdown', async () => {
  await this.stop();
  return {};
});
```

---

### 9. ‚ùå –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –≤ stop()
**–ü—Ä–æ–±–ª–µ–º–∞**: –ú–µ—Ç–æ–¥ `stop()` –ø—É—Å—Ç–æ–π –∏ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –Ω–∏–∫–∞–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π.

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**:
```typescript
async stop(): Promise<void> {
  if (this.server) {
    // Server –Ω–µ –∏–º–µ–µ—Ç –º–µ—Ç–æ–¥–∞ close –≤ stdio —Ä–µ–∂–∏–º–µ
    // –ü—Ä–æ—Ü–µ—Å—Å –±—É–¥–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º
  }
}
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è**:
- –ù–µ—Ç –æ—á–∏—Å—Ç–∫–∏ —Ä–µ—Å—É—Ä—Å–æ–≤
- –ù–µ—Ç –∑–∞–∫—Ä—ã—Ç–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- –ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è

**–†–µ—à–µ–Ω–∏–µ**:
```typescript
async stop(): Promise<void> {
  if (this.server) {
    try {
      // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ
      // –ó–∞–∫—Ä—ã—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
      // –û—á–∏—Å—Ç–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã
      this.server = null;
    } catch (error) {
      console.error('Error during MCP server stop:', error);
    }
  }
}
```

---

### 10. ‚ùå –ù–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è MCP –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤
**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ—Ç —Å–ø–æ—Å–æ–±–∞ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å MCP –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ, —Ç–∞–∫ –∫–∞–∫ –∑–∞–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã –Ω–µ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è.

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**:
- –¢–æ–ª—å–∫–æ `console.error` –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫
- –ù–µ—Ç structured logging
- –ù–µ—Ç debug —Ä–µ–∂–∏–º–∞

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è**:
- –°–ª–æ–∂–Ω–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã
- –ù–µ—Ç visibility –≤ —Ä–∞–±–æ—Ç—É MCP –ø—Ä–æ—Ç–æ–∫–æ–ª–∞

**–†–µ—à–µ–Ω–∏–µ**:
```typescript
// –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤
this.server.setRequestHandler(ListToolsRequestSchema, async (request) => {
  logger.debug('MCP Request: list_tools', request);
  const response = { tools };
  logger.debug('MCP Response: list_tools', response);
  return response;
});
```

---

## –°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### 11. ‚ö†Ô∏è –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ capabilities –∫–ª–∏–µ–Ω—Ç–∞
**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ initialize –∫–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –ø–µ—Ä–µ–¥–∞—Ç—å —Å–≤–æ–∏ capabilities, –Ω–æ –æ–Ω–∏ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è.

### 12. ‚ö†Ô∏è –ù–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ streaming responses
**–ü—Ä–æ–±–ª–µ–º–∞**: MCP –º–æ–∂–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å streaming –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤, –Ω–æ —ç—Ç–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è.

### 13. ‚ö†Ô∏è –ù–µ—Ç rate limiting –¥–ª—è MCP –∑–∞–ø—Ä–æ—Å–æ–≤
**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ MCP.

### 14. ‚ö†Ô∏è –ù–µ—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
**–ü—Ä–æ–±–ª–µ–º–∞**: `read_runtime_logs` –≤—Å–µ–≥–¥–∞ —á–∏—Ç–∞–µ—Ç –∏–∑ –ø–∞–º—è—Ç–∏, –Ω–æ –Ω–µ—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏.

---

## –ù–∏–∑–∫–æ–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### 15. üí° –ù–µ—Ç —Ç–µ—Å—Ç–æ–≤ –¥–ª—è MCP handlers
**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ—Ç unit/integration —Ç–µ—Å—Ç–æ–≤ –¥–ª—è MCP —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏.

### 16. üí° –ù–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ MCP API
**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–º MCP –º–µ—Ç–æ–¥–∞–º.

### 17. üí° –ù–µ—Ç –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è MCP –∑–∞–ø—Ä–æ—Å–æ–≤.

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º

### üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ (–∏—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ):
1. –î–æ–±–∞–≤–∏—Ç—å Initialize Request handler
2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –≤ CallToolRequestSchema
3. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å HTTP –∏ MCP —Å–µ—Ä–≤–µ—Ä—ã

### üü° –í–∞–∂–Ω–æ (–∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è):
4. –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É shutdown
5. –£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
6. –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —á–µ—Ä–µ–∑ JSON Schema

### üü¢ –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ (–º–æ–∂–Ω–æ –æ—Ç–ª–æ–∂–∏—Ç—å):
7. –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã
8. –£–ª—É—á—à–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
9. –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏
